<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
body { font-family:Cairo; background:#f4f6fb; margin:0; padding:20px; }
h2 { color:#0d47a1; }
input, button { font-family:Cairo; padding:10px; border-radius:10px; border:1px solid #ccc; }
button { cursor:pointer; border:none; }
.search { width:100%; max-width:500px; margin-bottom:10px; }
.add { background:#1976d2; color:#fff; }
.edit { background:#ffca28; }
.delete { background:#ef5350; color:#fff; }
table { width:100%; background:#fff; border-collapse:collapse; margin-top:15px; }
th { background:#1976d2; color:#fff; padding:10px; }
td { padding:8px; border-bottom:1px solid #eee; text-align:center; }
.actions button { margin:2px; }
#loading { position:fixed; inset:0; background:rgba(255,255,255,.9); display:none;
           align-items:center; justify-content:center; font-size:18px; }
</style>
</head>

<body>

<h2>Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>

<input id="search" class="search"
       placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø£Ùˆ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±ØªØ¨Ø© Ø£Ùˆ Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„">

<button class="add" onclick="openForm()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>

<div id="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

<table>
<thead>
<tr>
  <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ</th>
  <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
  <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯</th>
  <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆØ¸ÙŠÙ</th>
  <th>Ø§Ù„Ø±ØªØ¨Ø©</th>
  <th>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„</th>
  <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
  getFirestore, collection, query, where, limit, getDocs,
  doc, getDoc, setDoc, updateDoc, deleteDoc
} from
"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* Ø¹Ù†Ø§ØµØ± */
const searchInput = document.getElementById("search");
const tbody = document.getElementById("tbody");
const loading = document.getElementById("loading");

/* Ø£Ø¯ÙˆØ§Øª */
const showLoading = () => loading.style.display = "flex";
const hideLoading = () => loading.style.display = "none";
const debounce = (fn,d=400)=>{ let t; return(...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),d); }; };

/* ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø· */
async function searchEmployees(){
  const term = searchInput.value.trim().toLowerCase();
  tbody.innerHTML = "";
  if(!term) return;

  showLoading();
  try{
    const q = query(
      collection(db,"employeescom"),
      where("search",">=",term),
      where("search","<=",term+"\uf8ff"),
      limit(20)
    );
    const snap = await getDocs(q);
    snap.forEach(d => renderRow(d.id, d.data()));
  }catch(e){
    Swal.fire("Ø®Ø·Ø£","ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«","error");
  }finally{
    hideLoading();
  }
}
searchInput.addEventListener("input", debounce(searchEmployees));

/* Ø¹Ø±Ø¶ Ø³Ø·Ø± */
function renderRow(id,d){
  tbody.insertAdjacentHTML("beforeend",`
    <tr>
      <td>${id}</td>
      <td>${d.name||""}</td>
      <td>${d.diz||""}</td>
      <td>${d.dtw||""}</td>
      <td>${d.grade||""}</td>
      <td>${d.place||""}</td>
      <td class="actions">
        <button class="edit" onclick="openForm('${id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="delete" onclick="removeEmp('${id}')">Ø­Ø°Ù</button>
      </td>
    </tr>
  `);
}

/* â• Ø¥Ø¶Ø§ÙØ© / âœï¸ ØªØ¹Ø¯ÙŠÙ„ */
window.openForm = async (id=null)=>{
  let d = {};
  if(id){
    const snap = await getDoc(doc(db,"employeescom",id));
    if(snap.exists()) d = snap.data();
  }

  Swal.fire({
    title: id ? "ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù" : "Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯",
    showCancelButton:true,
    confirmButtonText:"Ø­ÙØ¸",
    cancelButtonText:"Ø¥Ù„ØºØ§Ø¡",
    html:`
      <input id="fid" class="swal2-input" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ"
             value="${id||""}" ${id?"disabled":""}>
      <input id="fname" class="swal2-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
             value="${d.name||""}">
      <label class="swal2-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯</label>
      <input id="fdiz" type="date" class="swal2-input"
             value="${d.diz||""}">
      <label class="swal2-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆØ¸ÙŠÙ</label>
      <input id="fdtw" type="date" class="swal2-input"
             value="${d.dtw||""}">
      <input id="fgrade" class="swal2-input" placeholder="Ø§Ù„Ø±ØªØ¨Ø©"
             value="${d.grade||""}">
      <input id="fplace" class="swal2-input" placeholder="Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„"
             value="${d.place||""}">
    `,
    preConfirm: async ()=>{
      const fid = document.getElementById("fid").value.trim();
      if(!/^\d{16}$/.test(fid))
        return Swal.showValidationMessage("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 16 Ø±Ù‚Ù…Ù‹Ø§");

      const data = {
        name: fname.value,
        diz: fdiz.value,
        dtw: fdtw.value,
        grade: fgrade.value,
        place: fplace.value,
        search: `${fid} ${fname.value} ${fgrade.value} ${fplace.value}`.toLowerCase()
      };

      if(id) await updateDoc(doc(db,"employeescom",id),data);
      else await setDoc(doc(db,"employeescom",fid),data);
    }
  });
};

/* ğŸ—‘ï¸ Ø­Ø°Ù */
window.removeEmp = async id=>{
  if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) return;
  await deleteDoc(doc(db,"employeescom",id));
  searchEmployees();
};
</script>

</body>
</html>
